// Generated by CoffeeScript 1.3.1
var Map,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

Map = (function() {

  Map.name = 'Map';

  function Map(server, sceneryTable) {
    this.server = server;
    this.sceneryTable = sceneryTable;
    this.loadPart = __bind(this.loadPart, this);

    this.getPixel = __bind(this.getPixel, this);

    this.drawArea = __bind(this.drawArea, this);

    this.lastPartLoaded = -1;
    this.objects = {
      obstacles: [],
      speedup: [],
      slowdown: []
    };
    this.map = ["oooooooooooo                                    ", "oxxxxxxxxxxo                                    ", "oxxxxxxxxxxo                                    ", "oooooooooooo                                    ", "                                                ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "xxxxxxxxxx                                      ", "xoooooooox                                      ", "xoooooooox                                      ", "xxxxxxxxxx               -------------          ", "                         -------------          ", "                         -------------          ", "                         -------------          ", "                                                ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "                                                ", "oooooooooooo                                    ", "oxxxxxxxxxxo                                    ", "oxxxxxxxxxxo                                    ", "oooooooooooo                                    ", "                                                ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "xxxxxxxxxx                                      ", "xoooooooox                                      ", "xoooooooox                                      ", "xxxxxxxxxx               -------------          ", "                         -------------          ", "                         -------------          ", "                         -------------          ", "                                                ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "                                                ", "oooooooooooo                                    ", "oxxxxxxxxxxo                                    ", "oxxxxxxxxxxo                                    ", "oooooooooooo                                    ", "                                                ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "xxxxxxxxxx                                      ", "xoooooooox                                      ", "xoooooooox                                      ", "xxxxxxxxxx               -------------          ", "                         -------------          ", "                         -------------          ", "                         -------------          ", "                                                ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "                                                ", "oooooooooooo                                    ", "oxxxxxxxxxxo                                    ", "oxxxxxxxxxxo                                    ", "oooooooooooo                                    ", "                                                ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "xxxxxxxxxx                                      ", "xoooooooox                                      ", "xoooooooox                                      ", "xxxxxxxxxx               -------------          ", "                         -------------          ", "                         -------------          ", "                         -------------          ", "                                                ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "                                                ", "oooooooooooo                                    ", "oxxxxxxxxxxo                                    ", "oxxxxxxxxxxo                                    ", "oooooooooooo                                    ", "                                                ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "xxxxxxxxxx                                      ", "xoooooooox                                      ", "xoooooooox                                      ", "xxxxxxxxxx               -------------          ", "                         -------------          ", "                         -------------          ", "                         -------------          ", "                                                ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "                                                ", "oooooooooooo                                    ", "oxxxxxxxxxxo                                    ", "oxxxxxxxxxxo                                    ", "oooooooooooo                                    ", "                                                ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                       +++++++++++++            ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "xxxxxxxxxx                                      ", "xoooooooox                                      ", "xoooooooox                                      ", "xxxxxxxxxx               -------------          ", "                         -------------          ", "                         -------------          ", "                         -------------          ", "                                                ", "                                                ", "                                                ", "                                                ", "                                                ", "              ooooooooooooo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "              oxxxxxxxxxxxo                     ", "               oxxxxxxxxxo                      ", "                oxxxxxxxo                       ", "                 ooooooo                        ", "                                                ", "                                                ", "                                                "];
    /*
            @server.onMapSegment (data) =>
                console.log 'map data', data
                
                # add it to the array
                for e in data.obstacles
                    do (e) =>
                        @objects.obstacles.push e
                #@objects.speedup.concat   newObjects.speedup
                #@objects.slowdown.concat  newObjects.slowdown
    */

  }

  Map.prototype.drawArea = function(offset) {
    var color, height, pixel, width, x, y, _i, _results;
    width = 48;
    height = 57;
    _results = [];
    for (y = _i = 0; 0 <= height ? _i <= height : _i >= height; y = 0 <= height ? ++_i : --_i) {
      _results.push((function() {
        var _j, _results1;
        _results1 = [];
        for (x = _j = 0; 0 <= width ? _j <= width : _j >= width; x = 0 <= width ? ++_j : --_j) {
          pixel = this.getPixel(x, y + offset);
          switch (pixel) {
            case " ":
              color = [0, 0, 0, 0];
              break;
            case "x":
              color = [0, 255, 126, 1];
              break;
            case "o":
              color = [0, 0, 0, 1];
              break;
            case "+":
              color = [255, 0, 255, 1];
              break;
            case "-":
              color = [0, 255, 255, 1];
          }
          _results1.push(this.sceneryTable.setPixel(x, height - y - 1, color));
        }
        return _results1;
      }).call(this));
    }
    return _results;
  };

  Map.prototype.getPixel = function(x, y) {
    return this.map[y].charAt(x);
  };

  Map.prototype.loadPart = function(part) {
    var i, start, _i;
    start = this.lastPartLoaded + 1;
    for (i = _i = start; start <= part ? _i < part : _i > part; i = start <= part ? ++_i : --_i) {
      this.server.askForMapSegment(i);
    }
    return this.lastPartLoaded = part;
  };

  return Map;

})();
